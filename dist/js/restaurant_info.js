let restaurant;var map;window.initMapRestaurant=(()=>{const e=getParameterByName("id");DBHelper.fillReviewDatabase(e),fetchRestaurantFromURL((e,t)=>{e?console.log(e):(self.map=new google.maps.Map(document.getElementById("map"),{zoom:16,center:t.latlng,scrollwheel:!1}),fillBreadcrumb(),DBHelper.mapMarkerForRestaurant(self.restaurant,self.map))})}),handleFav=(e=>{updateFav(e.checked),e.checked?localStorage.setItem("favBox","true"):localStorage.setItem("favBox","false")}),updateFav=(e=>{const t=getParameterByName("id");return localStorage.setItem(`checkBox${t}`,e),fetch(`http://localhost:1337/restaurants/${t}/?is_favorite=${e}`,{method:"PUT",mode:"cors",redirect:"follow"})}),getFormInfo=(()=>{const e=document.querySelector(".review-form").getAttribute("id").slice(12),t=document.querySelector(`#input-name-${e}`),n=document.querySelector(`#input-rating-${e}`),r=document.querySelector(`#input-comment-${e}`),a={restaurant_id:parseInt(e),name:t.value,rating:parseInt(n.value),comments:r.value};return t.value="",n.value="1",r.value="",a}),saveDataToIDB=((e,t)=>DBHelper.openReviewDatabase(t).then(t=>{if(!t)return;const n=t.transaction("reviews","readwrite");return n.objectStore("reviews").put(e),n.complete})),saveDataForBackgroundSync=(e=>DBHelper.openReviewDatabase("reviewSync").then(t=>{if(!t)return;const n=t.transaction("reviews","readwrite");return n.objectStore("reviews").put(e),n.complete})),fetchRestaurantFromURL=(e=>{if(self.restaurant)return void e(null,self.restaurant);const t=getParameterByName("id");t?DBHelper.fetchRestaurantById(t).then(t=>(self.restaurant=t,fillRestaurantHTML(),e(null,t))).catch(e=>{console.log(e)}):(error="No restaurant id in URL",e(error,null))}),fillRestaurantHTML=((e=self.restaurant)=>{document.getElementById("restaurant-name").innerHTML=e.name,document.getElementById("restaurant-address").innerHTML=e.address;const t=document.getElementById("restaurant-cuisine");t.innerHTML=e.cuisine_type;const n=document.createElement("picture");document.getElementById("restaurant-container").insertBefore(n,t);const r=document.createElement("input");r.setAttribute("id",`checkBox${e.id}`),r.setAttribute("type","checkbox"),r.setAttribute("role","checkbox"),r.setAttribute("onchange","handleFav(this)");const a=JSON.parse(localStorage.getItem(`checkBox${e.id}`));r.checked=a,document.getElementById("favorite").appendChild(r),DBHelper.picturesForRestaurant(e,n),e.operating_hours&&fillRestaurantHoursHTML(),DBHelper.getReviewFromDatabase(e.id).then(e=>{self.restaurant.reviews=e,fillReviewsHTML()}).catch(e=>{console.log(e)}),fillReviewFormHTML()}),fillReviewFormHTML=((e=self.restaurant)=>{const t=document.getElementById("reviews-form"),n=document.createElement("form"),r=document.createElement("input"),a=document.createElement("label"),i=document.createElement("select"),o=document.createElement("label"),l=document.createElement("textarea"),c=document.createElement("label"),d=document.createElement("input");let u=document.createElement("option");u.setAttribute("value","1"),u.innerHTML="1",i.appendChild(u),(u=document.createElement("option")).setAttribute("value","2"),u.innerHTML="2",i.appendChild(u),(u=document.createElement("option")).setAttribute("value","3"),u.innerHTML="3",i.appendChild(u),(u=document.createElement("option")).setAttribute("value","4"),u.innerHTML="4",i.appendChild(u),(u=document.createElement("option")).setAttribute("value","5"),u.innerHTML="5",i.appendChild(u),n.setAttribute("id",`review-form-${e.id}`),n.setAttribute("class","review-form"),r.setAttribute("type","text"),r.setAttribute("id",`input-name-${e.id}`),a.setAttribute("for",`input-name-${e.id}`),a.innerHTML="Name:",i.setAttribute("name","ratings"),i.setAttribute("id",`input-rating-${e.id}`),o.setAttribute("for",`input-rating-${e.id}`),o.innerHTML="Rating:",l.setAttribute("name","ratings"),l.setAttribute("id",`input-comment-${e.id}`),c.setAttribute("for",`input-comment-${e.id}`),c.innerHTML="Comment:",d.setAttribute("type","submit"),d.setAttribute("value","submit"),n.appendChild(a);let m=document.createElement("br");n.appendChild(m),n.appendChild(r),m=document.createElement("br"),n.appendChild(m),m=document.createElement("br"),n.appendChild(m),n.appendChild(o),m=document.createElement("br"),n.appendChild(m),n.appendChild(i),m=document.createElement("br"),n.appendChild(m),m=document.createElement("br"),n.appendChild(m),n.appendChild(c),m=document.createElement("br"),n.appendChild(m),n.appendChild(l),m=document.createElement("br"),n.appendChild(m),m=document.createElement("br"),n.appendChild(m),n.appendChild(d),t.appendChild(n),n.addEventListener("submit",e=>{e.preventDefault();const t=getFormInfo();saveDataForBackgroundSync(t),DBHelper.getReviewFromDatabase("reviewSync").then(e=>{e.forEach(e=>{console.log(e);const t=createReviewHTML(e);document.getElementById("reviews-list").appendChild(t)})}),navigator.serviceWorker.ready.then(function(e){e.sync.register("addReview")})})}),fillRestaurantHoursHTML=((e=self.restaurant.operating_hours)=>{const t=document.getElementById("restaurant-hours");for(let n in e){const r=document.createElement("tr"),a=document.createElement("td");a.innerHTML=n,r.appendChild(a);const i=document.createElement("td");i.innerHTML=e[n],r.appendChild(i),t.appendChild(r)}}),fillReviewsHTML=((e=self.restaurant.reviews)=>{const t=document.getElementById("reviews-container"),n=document.createElement("h2");if(n.innerHTML="Reviews",t.appendChild(n),!e){const e=document.createElement("p");return e.innerHTML="No reviews yet!",void t.appendChild(e)}const r=document.getElementById("reviews-list");e.forEach(e=>{r.appendChild(createReviewHTML(e))}),t.appendChild(r)}),createReviewHTML=(e=>{const t=document.createElement("li"),n=document.createElement("p");n.innerHTML=e.name,t.appendChild(n);const r=document.createElement("p");r.innerHTML=`Rating: ${e.rating}`,t.appendChild(r);const a=document.createElement("p");return a.innerHTML=e.comments,t.appendChild(a),t}),fillBreadcrumb=((e=self.restaurant)=>{const t=document.getElementById("breadcrumb-list"),n=document.createElement("li"),r=document.createElement("a");r.innerHTML=e.name,r.href=window.location.href,r.setAttribute("aria-current","page"),n.append(r),t.appendChild(n)}),getParameterByName=((e,t)=>{t||(t=window.location.href),e=e.replace(/[\[\]]/g,"\\$&");const n=new RegExp(`[?&]${e}(=([^&#]*)|&|#|$)`).exec(t);return n?n[2]?decodeURIComponent(n[2].replace(/\+/g," ")):"":null}),DBHelper.registerServiceWorker();